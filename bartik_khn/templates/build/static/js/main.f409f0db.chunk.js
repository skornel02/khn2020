(this["webpackJsonpreact-frontend"]=this["webpackJsonpreact-frontend"]||[]).push([[0],{130:function(e,t){},132:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(15),i=n.n(s);n(66),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o,u,l=n(7),c=n(5),d=n.n(c),p=n(9),m=n(27),f=n(21),h=n(56),v=n.n(h);function g(e){return{id:parseInt(e.uid),link:e._links.self.href}}!function(e){e[e.Anon=0]="Anon",e[e.Parent=1]="Parent",e[e.Kid=2]="Kid",e[e.Grandma=3]="Grandma"}(o||(o={})),function(e){e[e.Rejected=0]="Rejected",e[e.AwaitingConfirmation=1]="AwaitingConfirmation",e[e.Accepted=2]="Accepted"}(u||(u={}));var b=n(3),_=n.n(b),y="https://versenydonto.nisz.hu:10016",k=function(){function e(t){Object(f.a)(this,e),this.axios=void 0;var n={baseURL:y,withCredentials:!1};void 0!==t&&(n.auth={username:t.username,password:t.password}),this.axios=v.a.create(n)}return Object(m.a)(e,[{key:"doLogin",value:function(){var e=Object(p.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.post("/user/login?_format=hal_json",{name:t,pass:n}).then((function(e){var t;return{id:e.data.current_user.uid,username:e.data.current_user.name,roles:null!==(t=e.data.current_user.roles)&&void 0!==t?t:[],csrfToken:e.data.csrf_token,logoutToken:e.data.logout_token}})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCsrfToken",value:function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("/session/token?_format=hal_json").then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("/api/users_list?_format=hal_json").then((function(e){return e.data.map((function(e){var t=o.Anon;return e.roles.includes("szulo")?t=o.Parent:e.roles.includes("rokon")?t=o.Grandma:e.roles.includes("gyerek")&&(t=o.Kid),{id:e.uid,uuid:e.uuid,username:e.username,role:t}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLocations",value:function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("/api/location?_format=hal_json").then((function(e){return e.data.map((function(e){return{id:parseInt(e.nid),uuid:e.uuid,name:e.title}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createLocation",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={_links:{type:{href:y+"/rest/type/node/sav"}},title:[{value:t.name}]},e.abrupt("return",this.axios.post("/node?_format=hal_json",n,{headers:{"Content-Type":"application/hal+json"}}).then((function(e){return g(e.data)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRules",value:function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("/api/rule?_format=hal_json").then((function(e){return e.data.map((function(e){return{name:e.title,id:parseInt(e.nid),repeatRule:e.field_t_ismetlesi_szabaly,startDateTime:_.a.unix(parseInt(e.field_t_kezdesi_ido)),length:_()(e.field_idotartam,["hh:mm:ss"]),users:e.field_resztvevok.split(", ").map((function(e){return parseInt(e)}))}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createRule",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n={_links:{type:{href:y+"/rest/type/node/tiltas"}},title:[{value:t.name}],field_t_ismetlesi_szabaly:[{value:t.repeatRule}],field_t_kezdesi_ido:[{value:t.startDateTime.unix()}],field_idotartam:[{value:t.length.format(_.a.HTML5_FMT.TIME_SECONDS)}],field_resztvevok:[{value:t.userUUIDs.join(", ")}],_embedded:{}})._embedded[y+"/rest/relation/node/tiltas/field_resztvevok"]=[],t.userUUIDs.forEach((function(e){n._embedded[y+"/rest/relation/node/tiltas/field_resztvevok"].push({uuid:[{value:e}]})})),e.abrupt("return",this.axios.post("/node?_format=hal_json",n,{headers:{"Content-Type":"application/hal+json"}}).then((function(e){return g(e.data)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEventRequests",value:function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("/api/request?_format=hal_json").then((function(e){return e.data.map((function(e){var t=JSON.parse(e.field_leiras.replace(/(&quot\;)/g,'"'));return{id:parseInt(e.nid),status:e.field_allapot,type:e.title,description:t.description,length:_()(t.length,["hh:mm:ss"]),creationDate:_()(e.changed)}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createEventRequest",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={_links:{type:{href:y+"/rest/type/node/kerelem"}},title:[{value:t.type}],field_leiras:[{value:JSON.stringify({description:t.description,length:t.length.format(_.a.HTML5_FMT.TIME_SECONDS)})}],field_letrehozasi_datum:[{value:_()().unix()}],field_allapot:[{value:u.AwaitingConfirmation}]},e.abrupt("return",this.axios.post("/node?_format=hal_json",n,{headers:{"Content-Type":"application/hal+json"}}).then((function(e){return g(e.data)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getScheduleEvent",value:function(){var e=Object(p.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.axios.get("/api/event?_format=hal_json").then((function(e){return e.data.map((function(e){return{id:parseInt(e.nid),type:e.title,comment:e.field_megjegyzes,repeatRule:e.field_ismetlesi_szabaly,dueTime:_()(e.field_hatarido),startTimeDate:_.a.unix(parseInt(e.field_kezdesi_ido)),length:_()(e.field_idotartam,["hh:mm:ss"]),users:e.field_resztvevok.split(", ").map((function(e){return parseInt(e)})),location:parseInt(e.field_sav)}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createScheduleEvent",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n={_links:{type:{href:y+"/rest/type/node/napirend"}},title:[{value:t.name}],field_megjegyzes:[{value:t.content}],field_ismetlesi_szabaly:[{value:t.repeatRule}],field_kezdesi_ido:[{value:t.startDateTime.unix()}],field_idotartam:[{value:t.length.format(_.a.HTML5_FMT.TIME_SECONDS)}],_embedded:{}})._embedded[y+"/rest/relation/node/napirend/field_resztvevok"]=[],t.userUUIDs.forEach((function(e){n._embedded[y+"/rest/relation/node/napirend/field_resztvevok"].push({uuid:[{value:e}]})})),n._embedded[y+"/rest/relation/node/napirend/field_sav"]=[{uuid:[{value:t.locationUUID}]}],e.abrupt("return",this.axios.post("/node?_format=hal_json",n,{headers:{"Content-Type":"application/hal+json"}}).then((function(e){return g(e.data)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),E=new function e(){var t=this;Object(f.a)(this,e),this.backend=new k(void 0),this.user=void 0,this.login=function(e,n){return t.backend.doLogin(e,n).then((function(a){t.user=a,t.backend=new k({username:e,password:n})}))},this.logout=function(){t.backend=new k(void 0)}};var x,j=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),s=n[0],i=n[1],o=Object(a.useState)(""),u=Object(l.a)(o,2),c=u[0],d=u[1],p=Object(a.useState)(!1),m=Object(l.a)(p,2),f=m[0],h=m[1],v=Object(a.useState)(""),g=Object(l.a)(v,2),b=g[0],_=g[1],y=Object(a.useState)(""),k=Object(l.a)(y,2),x=k[0],j=k[1],w=localStorage.getItem("username"),R=localStorage.getItem("password");return null!==w&&null!==R&&E.login(w,R).then((function(t){e.login()})),r.a.createElement("div",{className:"flex justify-center h-screen"},r.a.createElement("form",{className:"bg-gray-200 shadow-md rounded px-8 pt-6 pb-8 m-auto text-sm sm:text-2xl"},b+x!==""?r.a.createElement("p",{className:"text-base text-red-500 mb-6 text-center font-bold"},"Helytelen jelsz\xf3, vagy felhaszn\xe1l\xf3n\xe9v!"):null,r.a.createElement("div",{className:"mb-4"},r.a.createElement("label",{className:"block text-gray-700 font-bold mb-2 "+x,htmlFor:"username"},"Felhaszn\xe1l\xf3n\xe9v"),r.a.createElement("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline "+b,id:"username",type:"text",placeholder:"Felhaszn\xe1l\xf3n\xe9v",onChange:function(e){return i(e.target.value)},value:s})),r.a.createElement("div",{className:"mb-3"},r.a.createElement("label",{className:"block text-gray-700 font-bold mb-2 "+x,htmlFor:"password"},"Jelsz\xf3"),r.a.createElement("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline "+b,id:"password",type:"password",placeholder:"******************",onChange:function(e){return d(e.target.value)},value:c})),r.a.createElement("div",{className:"flex justify-center mb-3"},r.a.createElement("label",{className:"lock text-gray-500 font-bold"},r.a.createElement("input",{className:"mr-2 leading-tight",type:"checkbox",onChange:function(e){return h(e.target.checked)}}),r.a.createElement("span",{className:"text-base"},"Jegyezz meg!"))),r.a.createElement("div",{className:"flex justify-center"},r.a.createElement("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"button",onClick:function(){E.login(s,c).then((function(t){e.login(),f&&(localStorage.setItem("username",s),localStorage.setItem("password",c))})).catch((function(e){var t;"Sorry, unrecognized username or password."===(null===(t=e.response)||void 0===t?void 0:t.data.message)&&(_("border-red-500"),j("text-red-500"))}))}},"Bejelentkez\xe9s"))))},w=n(59),R=n(58),O=(n(85),n(86),n(31)),z=n.n(O),S=n(120);!function(e){e[e.LocationBased=0]="LocationBased",e[e.UserBased=1]="UserBased"}(x||(x={}));var T=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}()?1:6,M=function(e){var t,n,s,i=Object(a.useState)(x.UserBased),o=Object(l.a)(i,2),u=o[0],c=o[1],d="",p=r.a.createElement(r.a.Fragment,null);switch(u){case x.LocationBased:d="Eszk\xf6z alap\xfa";var m=(t=e.locations,n=e.events,s=e.users,[t.map((function(e,t){return{id:t+1,title:e.name}})),n.flatMap((function(e,t){var n=e.users.map((function(e){return s.find((function(t){return t.id===e}))})).map((function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.username)&&void 0!==t?t:"-"})).join(", ");if(void 0!==e.repeatRule&&0!==e.repeatRule.length&&"0"!==e.repeatRule){for(var a=[],r=S.parseExpression(e.repeatRule),i=S.parseExpression(e.repeatRule),o=0;o<7;o++){var u=r.next().toDate();a.push({id:e.id+"::elore::"+o,group:e.location,start_time:_()(u),end_time:_()(u).add(e.length.hour(),"hours").add(e.length.minute(),"minutes"),title:n,canMove:!1,canResize:!1,canChangeGroup:!1})}for(var l=0;l<3;l++){var c=i.prev().toDate();a.push({id:e.id+"::elore::"+l,group:e.location,start_time:_()(c),end_time:_()(c).add(e.length.hour(),"hours").add(e.length.minute(),"minutes"),title:n,canMove:!1,canResize:!1,canChangeGroup:!1})}return a}return[{id:e.id,group:e.location,start_time:e.startTimeDate,end_time:e.startTimeDate.clone().add(e.length.hour(),"hours").add(e.length.minute(),"minutes"),title:n,canMove:!1,canResize:!1,canChangeGroup:!1}]}))]),f=Object(l.a)(m,2),h=f[0],v=f[1];p=r.a.createElement(z.a,{groups:h,items:v,defaultTimeStart:_()().add(0-T,"hour"),defaultTimeEnd:_()().add(T,"hour")});break;case x.UserBased:d="Szem\xe9ly alap\xfa";var g=function(e,t,n){return[n.map((function(e,t){return{id:e.username,title:e.username}})),t.flatMap((function(e,t){return e.users.map((function(e){return n.find((function(t){return t.id===e}))})).map((function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.username)&&void 0!==t?t:"-"})).flatMap((function(t){if(console.log(t),void 0!==e.repeatRule&&0!==e.repeatRule.length&&"0"!==e.repeatRule){for(var n=[],a=S.parseExpression(e.repeatRule),r=S.parseExpression(e.repeatRule),s=0;s<7;s++){var i=a.next().toDate();n.push({id:t+"::"+e.id+"::elore::"+s,group:t,start_time:_()(i),end_time:_()(i).add(e.length.hour(),"hours").add(e.length.minute(),"minutes"),title:e.type,canMove:!1,canResize:!1,canChangeGroup:!1})}for(var o=0;o<3;o++){var u=r.prev().toDate();n.push({id:t+"::"+e.id+"::elore::"+o,group:t,start_time:_()(u),end_time:_()(u).add(e.length.hour(),"hours").add(e.length.minute(),"minutes"),title:e.type,canMove:!1,canResize:!1,canChangeGroup:!1})}return n}return[{id:t+"::"+e.id,group:t,start_time:e.startTimeDate,end_time:e.startTimeDate.clone().add(e.length.hour(),"hours").add(e.length.minute(),"minutes"),title:e.location,canMove:!1,canResize:!1,canChangeGroup:!1}]}))}))]}(e.locations,e.events,e.users),b=Object(l.a)(g,2),y=b[0],k=b[1];p=r.a.createElement(z.a,{groups:y,items:k,defaultTimeStart:_()().add(0-T,"hour"),defaultTimeEnd:_()().add(T,"hour")})}return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){switch(u){case x.UserBased:c(x.LocationBased);break;case x.LocationBased:c(x.UserBased)}}},d),p)},D=n(150),I=n(154),C=n(151),q=n(152),N=n(153);var U=function(e){var t=Object(a.useState)("home"),n=Object(l.a)(t,2),s=n[0],i=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(D.a,{value:s,onChange:function(t,n){switch(i(n),n){case"home":e.toMain();break;case"people":e.toUsers&&e.toUsers();break;case"edit":e.toRequests()}}},r.a.createElement(I.a,{label:"F\u0151oldal",value:"home",icon:r.a.createElement(C.a,null)}),r.a.createElement(I.a,{label:"K\xe9relmek",value:"edit",icon:r.a.createElement(q.a,null)}),r.a.createElement(I.a,{label:"Emberek",value:"people",icon:r.a.createElement(N.a,null)})))};var L,B=function(e){return r.a.createElement("div",null,e.requests?e.requests.map((function(e){return r.a.createElement("div",null,r.a.createElement("p",null,"K\xe9r\xe9s: ",e.type),r.a.createElement("p",null,"Le\xedr\xe1s: ",e.description))})):null)};!function(e){e[e.DailyTimeline=0]="DailyTimeline",e[e.Requests=1]="Requests"}(L||(L={}));var F=function(e){Object(w.a)(n,e);var t=Object(R.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).toRequests=function(){a.setState({selectedMenu:L.Requests})},a.toMain=function(){a.setState({selectedMenu:L.DailyTimeline})},a.state={locations:void 0,events:void 0,requests:void 0,rules:void 0,users:void 0,loggedInRole:void 0,selectedMenu:0},a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var e=this;E.backend.getLocations().then((function(t){e.setState({locations:t})})),E.backend.getScheduleEvent().then((function(t){e.setState({events:t})})),E.backend.getEventRequests().then((function(t){e.setState({requests:t})})),E.backend.getRules().then((function(t){e.setState({rules:t})})),E.backend.getUsers().then((function(t){var n,a;t=t.filter((function(e){return 0!==e.id})),e.setState({users:t}),e.setState({loggedInRole:null!==(n=null===(a=t.find((function(e){var t;return e.username===(null===(t=E.user)||void 0===t?void 0:t.username)})))||void 0===a?void 0:a.role)&&void 0!==n?n:o.Anon})}))}},{key:"render",value:function(){if(!this.state.locations||!this.state.events||!this.state.users||!this.state.loggedInRole||!this.state.requests||!this.state.rules)return"Loading";var e=null;switch(this.state.selectedMenu){case L.DailyTimeline:e=r.a.createElement(M,{locations:this.state.locations,events:this.state.events,users:this.state.users});break;case L.Requests:e=r.a.createElement(B,{requests:this.state.requests})}return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"}},r.a.createElement("div",{style:{flex:"1",maxHeight:"91vh"}},e),r.a.createElement("div",{style:{height:"9vh"}},r.a.createElement(U,{toMain:this.toMain,toRequests:this.toRequests,userRole:this.state.loggedInRole})))}}]),n}(a.Component);var A=function(){var e=Object(a.useState)(r.a.createElement(j,{login:function(){s(r.a.createElement(F,null))}})),t=Object(l.a)(e,2),n=t[0],s=t[1];return r.a.createElement(r.a.Fragment,null,n)};i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(A,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},61:function(e,t,n){e.exports=n(132)},66:function(e,t,n){}},[[61,1,2]]]);
//# sourceMappingURL=main.f409f0db.chunk.js.map